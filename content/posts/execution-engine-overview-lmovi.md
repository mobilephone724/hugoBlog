---
title: 执行引擎概览
slug: execution-engine-overview-lmovi
url: /post/execution-engine-overview-lmovi.html
date: '2025-03-03 22:25:12+08:00'
lastmod: '2025-03-03 22:30:30+08:00'
toc: true
isCJKLanguage: true
---



# 执行引擎概览

FROM deepseek

### **执行引擎对比表**

|**类型**|**数据处理方式**|**优势场景**|**劣势场景**|**代表系统**|
| ------------| --------------| -------------------| ------------------| ----------------------|
|Volcano|逐行处理|OLTP 短查询|复杂分析查询|MySQL、PostgreSQL|
|向量化|按列批量处理|OLAP 扫描/聚合|高并发点查|ClickHouse、Redshift|
|编译执行|编译为机器码|复杂查询（Join）|短查询编译开销|HyPer、MemSQL|
|MPP|分布式并行|海量数据分析|网络延迟敏感场景|Presto、Snowflake|
|Push-Based|流水线推送|流式处理/实时计算|复杂查询资源管理|Apache Flink|
|混合型|动态选择模式|混合负载（HTAP）|实现复杂度高|TiDB、DuckDB|

---

### **SQL 执行引擎的主要类型及特点**

SQL 执行引擎是数据库系统的核心组件，负责将优化后的查询计划转换为实际的数据操作。不同的执行引擎设计直接影响查询性能、资源利用率和适用场景。以下是常见的 SQL 执行引擎类型及其特点：

---

#### **1. Volcano 模型（迭代器模型）**

* **核心思想**：逐行处理数据，通过迭代器（`next()`​ 方法）逐条获取记录。
* **特点**：

  * **逐行处理**：每个算子（如 `Join`​、`Filter`​）处理一行数据后传递给下一算子。
  * **高灵活性**：支持任意复杂查询计划的动态组合。
  * **低效的 CPU 缓存利用**：频繁的函数调用和逐行处理导致缓存不友好。
* **适用场景**：传统 OLTP 系统（如 MySQL、PostgreSQL 的早期版本）。
* **缺点**：大量虚函数调用和分支预测错误，性能瓶颈明显。

---

#### **2. 向量化执行引擎（Vectorized Execution）**

* **核心思想**：按列批量处理数据（一次处理一批记录，称为向量）。
* **特点**：

  * **批量处理**：减少函数调用次数，提高 CPU 缓存命中率。
  * **SIMD 优化**：利用现代 CPU 的 SIMD 指令加速列式数据计算。
  * **适合列式存储**：与列存格式（如 Parquet、ORC）天然契合。
* **适用场景**：OLAP 系统（如 ClickHouse、Amazon Redshift）。
* **优点**：显著提升扫描和聚合操作的吞吐量。
* **缺点**：对短查询或随机点查优化有限。

---

#### **3. 编译执行引擎（Compiled Execution）**

* **核心思想**：将查询计划直接编译为机器码（如 LLVM IR），消除解释执行的开销。
* **特点**：

  * **消除虚函数调用**：直接生成高效机器指令。
  * **循环融合（Loop Fusion）** ：合并多个算子的循环，减少中间结果暂存。
  * **运行时优化**：根据数据分布动态生成代码（如分支预测）。
* **适用场景**：高性能 OLAP 或 HTAP 系统（如 HyPer、MemSQL）。
* **优点**：复杂查询（如多表 Join）性能提升显著。
* **缺点**：编译时间可能成为短查询的瓶颈。

---

#### **4. MPP 执行引擎（Massively Parallel Processing）**

* **核心思想**：将查询任务拆分到多个节点并行执行。
* **特点**：

  * **数据分片与分布式计算**：通过 Shuffle 或 Broadcast 实现跨节点数据交换。
  * **容错机制**：部分系统支持中间结果持久化（如 Spark SQL）。
  * **资源隔离**：通过分布式资源管理器（如 YARN、Kubernetes）分配资源。
* **适用场景**：大规模数据分析（如 Apache Hive、Presto、Snowflake）。
* **优点**：线性扩展能力，适合 PB 级数据处理。
* **缺点**：网络传输和协调开销较大。

---

#### **5. 基于 Push 的执行引擎**

* **核心思想**：数据从源算子“推”向消费算子，而非迭代器模型的“拉”取。
* **特点**：

  * **流水线并行**：多个算子可同时处理不同阶段的数据。
  * **减少中间物化**：避免将中间结果写入内存或磁盘。
  * **适合流处理**：天然支持无界数据流的持续计算。
* **适用场景**：流式 SQL 引擎（如 Apache Flink、KSQL）。
* **优点**：低延迟，适合实时处理。
* **缺点**：复杂查询的资源管理难度较高。

---

#### **6. 混合型执行引擎**

* **核心思想**：结合多种模型的优势（如向量化+编译执行）。
* **特点**：

  * **动态选择执行模式**：根据查询类型选择向量化或编译执行。
  * **自适应优化**：根据运行时统计信息调整执行策略。
* **适用场景**：现代 OLAP 系统（如 ClickHouse 22.x 支持 JIT 编译）。
* **代表系统**：TiDB（向量化 + MPP）、DuckDB（向量化 + 编译执行）。

---

---

### **选择执行引擎的考量因素**

1. **负载类型**：

    * OLTP：Volcano 或编译执行（低延迟）。
    * OLAP：向量化或 MPP（高吞吐）。
    * 流处理：Push-Based 引擎。
2. **数据规模**：

    * 单机小数据：向量化或编译执行。
    * 分布式大数据：MPP。
3. **硬件特性**：

    * 多核 CPU：向量化或编译执行（SIMD/并行）。
    * 高速网络：MPP（减少 Shuffle 开销）。

---

### **未来趋势**

* **硬件加速**：利用 GPU、FPGA 或存算一体架构优化特定算子。
* **自适应引擎**：根据负载动态切换执行模式（如 Snowflake 的弹性执行）。
* **统一引擎**：融合事务与分析（HTAP），如 TiDB、Oracle Exadata。

---

通过理解不同执行引擎的特点，可以更好地选择适合业务场景的数据库系统，或在系统调优时针对性地设计查询模式。
